/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var F=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var M=(o,t)=>{for(var e in t)F(o,e,{get:t[e],enumerable:!0})},_=(o,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of z(t))!K.call(o,n)&&n!==e&&F(o,n,{get:()=>t[n],enumerable:!(i=V(t,n))||i.enumerable});return o};var j=o=>_(F({},"__esModule",{value:!0}),o);var G={};M(G,{default:()=>k});module.exports=j(G);var l=require("obsidian");function N(o){let t=new Date;return{...o,createdAt:t,updatedAt:t}}function T(o){return{...o,createdAt:o.createdAt.toISOString(),updatedAt:o.updatedAt.toISOString()}}function I(o){return{...o,createdAt:new Date(o.createdAt),updatedAt:new Date(o.updatedAt)}}function A(o){return[...o].sort((t,e)=>e.similarity-t.similarity)}function C(o,t){return o.slice(0,t)}async function u(o){let e=new TextEncoder().encode(o);try{let i=await crypto.subtle.digest("SHA-256",e);return`sha256:${Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}`}catch(i){return`simple:${L(o)}`}}function L(o){let t=0;for(let e=0;e<o.length;e++){let i=o.charCodeAt(e);t=(t<<5)-t+i,t=t&t}return Math.abs(t).toString(16)}function b(o,t){return o===null||t===null?!1:o===t}var f=class{constructor(t,e,i){this.embeddingProvider=t;this.embeddingRepository=e;this.noteRepository=i}async execute(t){let e=await this.noteRepository.findById(t);if(!e)throw new Error(`Note not found: ${t}`);let i=await u(e.content),n=await this.embeddingRepository.getContentHash(t);if(n&&b(n,i)){let a=await this.embeddingRepository.findById(t);if(a)return{embedding:a,wasUpdated:!1,reason:"skipped"}}let s=await this.embeddingProvider.embed(e.content),r=N({noteId:t,notePath:e.path,title:e.title,contentHash:i,vector:s,model:this.embeddingProvider.getModel(),provider:this.embeddingProvider.getProvider(),dimensions:this.embeddingProvider.getDimensions()});return await this.embeddingRepository.save(r),{embedding:r,wasUpdated:!0,reason:n?"stale":"new"}}async embedIfStale(t,e){let i=await this.embeddingRepository.getContentHash(t);return i&&b(i,e)?null:(await this.execute(t)).embedding}async forceEmbed(t){let e=await this.noteRepository.findById(t);if(!e)throw new Error(`Note not found: ${t}`);let i=await u(e.content),n=await this.embeddingProvider.embed(e.content),s=N({noteId:t,notePath:e.path,title:e.title,contentHash:i,vector:n,model:this.embeddingProvider.getModel(),provider:this.embeddingProvider.getProvider(),dimensions:this.embeddingProvider.getDimensions()});return await this.embeddingRepository.save(s),s}};var y=class{constructor(t,e){this.embeddingProvider=t;this.embeddingRepository=e}async execute(t,e){let{limit:i=10,threshold:n=.3,excludeNoteIds:s=[],excludeFolders:r=[]}=e||{},a=await this.embeddingProvider.embed(t),m=await this.embeddingRepository.findAll(),c=[];for(let h of m){if(s.includes(h.noteId)||r.some(S=>h.notePath.startsWith(S+"/")))continue;let p=this.cosineSimilarity(a,h.vector);p>=n&&c.push({noteId:h.noteId,notePath:h.notePath,title:h.title,similarity:p})}let P=A(c);return C(P,i)}async findSimilarToNote(t,e){let i=await this.embeddingRepository.findById(t);if(!i)throw new Error(`Embedding not found for note: ${t}`);let{limit:n=10,threshold:s=.3,excludeNoteIds:r=[],excludeFolders:a=[]}=e||{},m=[...r,t],c=await this.embeddingRepository.findAll(),P=[];for(let p of c){if(m.includes(p.noteId)||a.some(H=>p.notePath.startsWith(H+"/")))continue;let S=this.cosineSimilarity(i.vector,p.vector);S>=s&&P.push({noteId:p.noteId,notePath:p.notePath,title:p.title,similarity:S})}let h=A(P);return C(h,n)}cosineSimilarity(t,e){if(t.length!==e.length)throw new Error("Vector dimensions must match");let i=0,n=0,s=0;for(let a=0;a<t.length;a++)i+=t[a]*e[a],n+=t[a]*t[a],s+=e[a]*e[a];let r=Math.sqrt(n)*Math.sqrt(s);return r===0?0:i/r}};var E=class{constructor(t,e,i){this.embeddingProvider=t;this.embeddingRepository=e;this.noteRepository=i;this.embedNoteUseCase=new f(t,e,i),this.searchSimilarUseCase=new y(t,e)}isAvailable(){return this.embeddingProvider.isAvailable()}async embedNote(t){return this.embedNoteUseCase.execute(t)}async embedAllNotes(t=[],e){let i=await this.noteRepository.findAllExcluding(t),n={total:i.length,completed:0,skipped:0,failed:0,currentNote:null};for(let s of i){n.currentNote=s.path,e==null||e(n);try{(await this.embedNoteUseCase.execute(s.noteId)).reason==="skipped"&&n.skipped++,n.completed++}catch(r){console.error(`Failed to embed ${s.path}:`,r),n.failed++}}return n.currentNote=null,e==null||e(n),await this.embeddingRepository.updateIndex(),{success:n.completed-n.skipped,skipped:n.skipped,failed:n.failed}}async embedStaleNotes(t=[],e){let i=await this.noteRepository.findAllExcluding(t),n={total:i.length,completed:0,skipped:0,failed:0,currentNote:null},s=0;for(let r of i){n.currentNote=r.path,e==null||e(n);try{let a=await u(r.content),m=await this.embeddingRepository.getContentHash(r.noteId);m&&b(m,a)?n.skipped++:(await this.embedNoteUseCase.execute(r.noteId),s++),n.completed++}catch(a){console.error(`Failed to embed ${r.path}:`,a),n.failed++}}return n.currentNote=null,e==null||e(n),await this.embeddingRepository.updateIndex(),{updated:s,skipped:n.skipped,failed:n.failed}}async searchSimilar(t,e){return this.searchSimilarUseCase.execute(t,e)}async findSimilarToNote(t,e){return this.searchSimilarUseCase.findSimilarToNote(t,e)}async getStats(){let t=await this.embeddingRepository.getIndex();return{totalEmbeddings:t.totalNotes,model:t.model||this.embeddingProvider.getModel(),provider:this.embeddingProvider.getProvider(),dimensions:t.dimensions||this.embeddingProvider.getDimensions(),lastUpdated:t.lastUpdated||null}}async deleteEmbedding(t){await this.embeddingRepository.delete(t),await this.embeddingRepository.updateIndex()}async clearAllEmbeddings(){await this.embeddingRepository.clear()}async hasEmbedding(t){return this.embeddingRepository.exists(t)}async getEmbedding(t){return this.embeddingRepository.findById(t)}};var D=require("obsidian"),$="https://api.openai.com/v1/embeddings",q="text-embedding-3-small",J=1536,v=class{constructor(t,e=q,i=J){this.apiKey=t;this.model=e,this.dimensions=i}async embed(t){return(await this.callOpenAI([t])).data[0].embedding}async embedBatch(t){let i=[];for(let n=0;n<t.length;n+=100){let s=t.slice(n,n+100),a=(await this.callOpenAI(s)).data.sort((m,c)=>m.index-c.index);i.push(...a.map(m=>m.embedding))}return i}isAvailable(){return!!this.apiKey&&this.apiKey.length>0}getModel(){return this.model}getProvider(){return"openai"}getDimensions(){return this.dimensions}async testApiKey(t){try{return(await(0,D.requestUrl)({url:$,method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model,input:"test"})})).status===200}catch(e){return!1}}setApiKey(t){this.apiKey=t}async callOpenAI(t){if(!this.apiKey)throw new Error("OpenAI API key not configured");let e=t.map(i=>{let n=i.trim();return n.length>0?n:" "});try{let i=await(0,D.requestUrl)({url:$,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model,input:e})});if(i.status!==200)throw new Error(`OpenAI API error: ${i.status}`);return i.json}catch(i){throw i instanceof Error?new Error(`OpenAI embedding failed: ${i.message}`):i}}};var g=require("obsidian");var B="1.0.0",W={storagePath:"09_Embedded",embeddingsFolder:"embeddings"},w=class{constructor(t,e){this.app=t;this.indexCache=null;this.config={...W,...e}}async initialize(){let t=this.config.storagePath,e=`${t}/${this.config.embeddingsFolder}`;await this.ensureFolder(t),await this.ensureFolder(e);let i=this.getIndexPath();await this.fileExists(i)||await this.saveIndex(this.createEmptyIndex())}async save(t){let e=this.getEmbeddingPath(t.noteId),i=T(t),n=JSON.stringify(i,null,2);await this.writeFile(e,n),this.invalidateIndexCache()}async saveBatch(t){for(let e of t)await this.save(e)}async findById(t){let e=this.getEmbeddingPath(t);if(!await this.fileExists(e))return null;try{let i=await this.readFile(e),n=JSON.parse(i);return I(n)}catch(i){return null}}async findByPath(t){let e=await this.getIndex();for(let[i,n]of Object.entries(e.notes))if(n.path===t)return this.findById(i);return null}async findAll(){let t=await this.getIndex(),e=[];for(let i of Object.keys(t.notes)){let n=await this.findById(i);n&&e.push(n)}return e}async delete(t){let e=this.getEmbeddingPath(t);await this.deleteFile(e),this.invalidateIndexCache()}async exists(t){let e=this.getEmbeddingPath(t);return this.fileExists(e)}async getContentHash(t){var i;return((i=(await this.getIndex()).notes[t])==null?void 0:i.contentHash)||null}async updateIndex(){let t=`${this.config.storagePath}/${this.config.embeddingsFolder}`,e=this.app.vault.getAbstractFileByPath(t);if(!(e instanceof g.TFolder)){await this.saveIndex(this.createEmptyIndex());return}let i={},n="",s=0;for(let a of e.children)if(a instanceof g.TFile&&a.extension==="json")try{let m=await this.app.vault.read(a),c=I(JSON.parse(m));i[c.noteId]={path:c.notePath,contentHash:c.contentHash,updatedAt:c.updatedAt.toISOString()},n||(n=c.model),s||(s=c.dimensions)}catch(m){}let r={version:B,totalNotes:Object.keys(i).length,lastUpdated:new Date().toISOString(),model:n,dimensions:s,notes:i};await this.saveIndex(r)}async getIndex(){if(this.indexCache)return this.indexCache;let t=this.getIndexPath();if(!await this.fileExists(t)){let e=this.createEmptyIndex();return this.indexCache=e,e}try{let e=await this.readFile(t),i=JSON.parse(e);return this.indexCache=i,i}catch(e){let i=this.createEmptyIndex();return this.indexCache=i,i}}async count(){return(await this.getIndex()).totalNotes}async clear(){let t=`${this.config.storagePath}/${this.config.embeddingsFolder}`,e=this.app.vault.getAbstractFileByPath(t);if(e instanceof g.TFolder)for(let i of e.children)i instanceof g.TFile&&await this.app.vault.delete(i);await this.saveIndex(this.createEmptyIndex())}getIndexPath(){return`${this.config.storagePath}/index.json`}getEmbeddingPath(t){let e=t.replace(/[^a-zA-Z0-9-_]/g,"_");return`${this.config.storagePath}/${this.config.embeddingsFolder}/${e}.json`}createEmptyIndex(){return{version:B,totalNotes:0,lastUpdated:new Date().toISOString(),model:"",dimensions:0,notes:{}}}async saveIndex(t){let e=this.getIndexPath(),i=JSON.stringify(t,null,2);await this.writeFile(e,i),this.indexCache=t}invalidateIndexCache(){this.indexCache=null}async ensureFolder(t){this.app.vault.getAbstractFileByPath(t)||await this.app.vault.createFolder(t)}async fileExists(t){return this.app.vault.getAbstractFileByPath(t)instanceof g.TFile}async readFile(t){let e=this.app.vault.getAbstractFileByPath(t);if(!(e instanceof g.TFile))throw new Error(`File not found: ${t}`);return this.app.vault.read(e)}async writeFile(t,e){let i=this.app.vault.getAbstractFileByPath(t);i instanceof g.TFile?await this.app.vault.modify(i,e):await this.app.vault.create(t,e)}async deleteFile(t){let e=this.app.vault.getAbstractFileByPath(t);e instanceof g.TFile&&await this.app.vault.delete(e)}};var O=require("obsidian"),x=class{constructor(t){this.app=t}async findById(t){let e=this.app.vault.getMarkdownFiles();for(let i of e)if(this.generateNoteId(i.path)===t)return this.fileToNoteContent(i);return null}async findByPath(t){let e=this.app.vault.getAbstractFileByPath(t);return e instanceof O.TFile?this.fileToNoteContent(e):null}async findAllMarkdownNotes(){let t=this.app.vault.getMarkdownFiles(),e=[];for(let i of t){let n=await this.fileToNoteContent(i);n&&e.push(n)}return e}async findByFolder(t){let e=this.app.vault.getMarkdownFiles(),i=[];for(let n of e)if(n.path.startsWith(t+"/")){let s=await this.fileToNoteContent(n);s&&i.push(s)}return i}async findAllExcluding(t){let e=this.app.vault.getMarkdownFiles(),i=[];for(let n of e)if(!t.some(r=>n.path.startsWith(r+"/")||n.path===r)){let r=await this.fileToNoteContent(n);r&&i.push(r)}return i}async exists(t){return await this.findById(t)!==null}generateNoteId(t){let e=t.replace(/\.md$/,"");return this.simpleHash(e)}async fileToNoteContent(t){try{let e=await this.app.vault.cachedRead(t);return{noteId:this.generateNoteId(t.path),path:t.path,title:t.basename,content:e,modifiedAt:new Date(t.stat.mtime)}}catch(e){return null}}simpleHash(t){let e=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return Math.abs(e).toString(16).padStart(8,"0")}};var U={openaiApiKey:"",storagePath:"09_Embedded",excludedFolders:["06_Meta","Templates"],autoEmbed:!0,autoEmbedDelay:5e3,model:"text-embedding-3-small"};var d=require("obsidian"),R=class extends d.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Vault Embeddings Settings"}),t.createEl("h3",{text:"API Settings"}),new d.Setting(t).setName("OpenAI API Key").setDesc("API key for generating embeddings (text-embedding-3-small)").addText(i=>{i.setPlaceholder("sk-...").setValue(this.plugin.settings.openaiApiKey).onChange(async n=>{this.plugin.settings.openaiApiKey=n,await this.plugin.saveSettings()}),i.inputEl.type="password",i.inputEl.style.width="300px"}).addButton(i=>{i.setButtonText("Test").onClick(async()=>{if(!this.plugin.settings.openaiApiKey){new d.Notice("Please enter an API key first");return}i.setDisabled(!0),i.setButtonText("Testing...");try{await this.plugin.testApiKey()?new d.Notice("API key is valid!"):new d.Notice("API key is invalid")}catch(n){new d.Notice("Test failed: "+(n instanceof Error?n.message:"Unknown error"))}finally{i.setDisabled(!1),i.setButtonText("Test")}})}),t.createEl("h3",{text:"Storage Settings"}),new d.Setting(t).setName("Storage Folder").setDesc("Folder to store embedding data (will be created if not exists)").addText(i=>i.setPlaceholder("09_Embedded").setValue(this.plugin.settings.storagePath).onChange(async n=>{this.plugin.settings.storagePath=n||"09_Embedded",await this.plugin.saveSettings()})),new d.Setting(t).setName("Excluded Folders").setDesc("Folders to exclude from embedding (comma-separated)").addText(i=>i.setPlaceholder("06_Meta, Templates").setValue(this.plugin.settings.excludedFolders.join(", ")).onChange(async n=>{this.plugin.settings.excludedFolders=n.split(",").map(s=>s.trim()).filter(s=>s.length>0),await this.plugin.saveSettings()})),t.createEl("h3",{text:"Auto Embedding"}),new d.Setting(t).setName("Auto Embed on Modify").setDesc("Automatically update embeddings when notes are modified").addToggle(i=>i.setValue(this.plugin.settings.autoEmbed).onChange(async n=>{this.plugin.settings.autoEmbed=n,await this.plugin.saveSettings()})),new d.Setting(t).setName("Auto Embed Delay").setDesc("Delay before auto-embedding after modification (in seconds)").addSlider(i=>i.setLimits(1,30,1).setValue(this.plugin.settings.autoEmbedDelay/1e3).setDynamicTooltip().onChange(async n=>{this.plugin.settings.autoEmbedDelay=n*1e3,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Actions"}),new d.Setting(t).setName("Embed All Notes").setDesc("Generate embeddings for all notes in the vault").addButton(i=>{i.setButtonText("Embed All").setCta().onClick(async()=>{if(!this.plugin.isConfigured()){new d.Notice("Please configure API key first");return}i.setDisabled(!0),i.setButtonText("Embedding...");try{let n=await this.plugin.embedAllNotes(s=>{i.setButtonText(`${s.completed}/${s.total} (${s.skipped} skipped)`)});new d.Notice(`Embedding complete! ${n.success} new, ${n.skipped} skipped, ${n.failed} failed`)}catch(n){new d.Notice("Embedding failed: "+(n instanceof Error?n.message:"Unknown error"))}finally{i.setDisabled(!1),i.setButtonText("Embed All")}})}),new d.Setting(t).setName("Update Stale Embeddings").setDesc("Only update embeddings for modified notes").addButton(i=>{i.setButtonText("Update Stale").onClick(async()=>{if(!this.plugin.isConfigured()){new d.Notice("Please configure API key first");return}i.setDisabled(!0),i.setButtonText("Updating...");try{let n=await this.plugin.embedStaleNotes(s=>{i.setButtonText(`${s.completed}/${s.total}`)});new d.Notice(`Update complete! ${n.updated} updated, ${n.skipped} skipped, ${n.failed} failed`)}catch(n){new d.Notice("Update failed: "+(n instanceof Error?n.message:"Unknown error"))}finally{i.setDisabled(!1),i.setButtonText("Update Stale")}})}),new d.Setting(t).setName("Clear All Embeddings").setDesc("Delete all stored embeddings").addButton(i=>{i.setButtonText("Clear All").setWarning().onClick(async()=>{if(confirm("Are you sure you want to delete all embeddings?"))try{await this.plugin.clearAllEmbeddings(),new d.Notice("All embeddings cleared")}catch(s){new d.Notice("Clear failed: "+(s instanceof Error?s.message:"Unknown error"))}})}),t.createEl("h3",{text:"Statistics"});let e=t.createDiv({cls:"vault-embeddings-stats"});this.displayStats(e)}async displayStats(t){t.empty();try{let e=await this.plugin.getStats();t.createEl("p",{text:`Total embeddings: ${e.totalEmbeddings}`}),t.createEl("p",{text:`Model: ${e.model||"Not set"}`}),t.createEl("p",{text:`Provider: ${e.provider||"Not set"}`}),t.createEl("p",{text:`Dimensions: ${e.dimensions||"Not set"}`}),t.createEl("p",{text:`Last updated: ${e.lastUpdated||"Never"}`})}catch(e){t.createEl("p",{text:"Unable to load statistics"})}}};var k=class extends l.Plugin{constructor(){super(...arguments);this.embeddingProvider=null;this.embeddingRepository=null;this.noteRepository=null;this.embeddingService=null;this.autoEmbedDebounced=null}async onload(){console.log("Loading Vault Embeddings Plugin"),await this.loadSettings(),await this.initializeServices(),this.addCommand({id:"embed-current-note",name:"Embed current note",callback:()=>this.embedCurrentNote()}),this.addCommand({id:"embed-all-notes",name:"Embed all notes",callback:()=>this.embedAllNotesCommand()}),this.addCommand({id:"update-stale-embeddings",name:"Update stale embeddings",callback:()=>this.updateStaleCommand()}),this.addCommand({id:"show-embedding-stats",name:"Show embedding statistics",callback:()=>this.showStatsCommand()}),this.addSettingTab(new R(this.app,this)),this.registerVaultEvents(),this.addRibbonIcon("database","Vault Embeddings",()=>{this.showStatsCommand()})}async onunload(){console.log("Unloading Vault Embeddings Plugin")}async loadSettings(){this.settings=Object.assign({},U,await this.loadData())}async saveSettings(){await this.saveData(this.settings),await this.initializeServices()}async initializeServices(){if(!this.settings.openaiApiKey){console.log("Vault Embeddings: API key not configured");return}try{this.embeddingProvider=new v(this.settings.openaiApiKey,this.settings.model),this.embeddingRepository=new w(this.app,{storagePath:this.settings.storagePath}),await this.embeddingRepository.initialize(),this.noteRepository=new x(this.app),this.embeddingService=new E(this.embeddingProvider,this.embeddingRepository,this.noteRepository),this.setupAutoEmbed(),console.log("Vault Embeddings: Services initialized")}catch(e){console.error("Failed to initialize services:",e)}}setupAutoEmbed(){this.autoEmbedDebounced&&(this.autoEmbedDebounced=null),this.settings.autoEmbed&&this.embeddingService&&(this.autoEmbedDebounced=(0,l.debounce)(async e=>{if(!(!this.embeddingService||!this.noteRepository||this.settings.excludedFolders.some(n=>e.path.startsWith(n+"/"))))try{let n=this.noteRepository.generateNoteId(e.path);await this.embeddingService.embedNote(n),console.log(`Auto-embedded: ${e.path}`)}catch(n){console.error(`Auto-embed failed for ${e.path}:`,n)}},this.settings.autoEmbedDelay,!0))}registerVaultEvents(){this.registerEvent(this.app.vault.on("modify",e=>{e instanceof l.TFile&&e.extension==="md"&&this.autoEmbedDebounced&&this.autoEmbedDebounced(e)})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof l.TFile&&e.extension==="md"&&this.autoEmbedDebounced&&this.autoEmbedDebounced(e)})),this.registerEvent(this.app.vault.on("delete",async e=>{if(e instanceof l.TFile&&e.extension==="md"&&this.embeddingService&&this.noteRepository)try{let i=this.noteRepository.generateNoteId(e.path);await this.embeddingService.deleteEmbedding(i),console.log(`Deleted embedding: ${e.path}`)}catch(i){console.error(`Failed to delete embedding for ${e.path}:`,i)}})),this.registerEvent(this.app.vault.on("rename",async(e,i)=>{if(e instanceof l.TFile&&e.extension==="md"&&this.embeddingService&&this.noteRepository)try{let n=this.noteRepository.generateNoteId(i);await this.embeddingService.deleteEmbedding(n),this.autoEmbedDebounced&&this.autoEmbedDebounced(e)}catch(n){console.error(`Failed to handle rename for ${e.path}:`,n)}}))}isConfigured(){return!!this.settings.openaiApiKey&&!!this.embeddingService}async testApiKey(){return this.embeddingProvider?this.embeddingProvider.testApiKey(this.settings.openaiApiKey):!1}async embedAllNotes(e){if(!this.embeddingService)throw new Error("Embedding service not initialized");return this.embeddingService.embedAllNotes(this.settings.excludedFolders,e)}async embedStaleNotes(e){if(!this.embeddingService)throw new Error("Embedding service not initialized");return this.embeddingService.embedStaleNotes(this.settings.excludedFolders,e)}async clearAllEmbeddings(){if(!this.embeddingService)throw new Error("Embedding service not initialized");await this.embeddingService.clearAllEmbeddings()}async getStats(){return this.embeddingService?this.embeddingService.getStats():{totalEmbeddings:0,model:this.settings.model,provider:"openai",dimensions:1536,lastUpdated:null}}async searchSimilar(e,i){return this.embeddingService?this.embeddingService.searchSimilar(e,i):[]}async findSimilarToNote(e,i){if(!this.embeddingService||!this.noteRepository)return[];let n=this.noteRepository.generateNoteId(e);return this.embeddingService.findSimilarToNote(n,i)}async embedCurrentNote(){if(!this.embeddingService||!this.noteRepository){new l.Notice("Embedding service not configured");return}let e=this.app.workspace.getActiveFile();if(!e||e.extension!=="md"){new l.Notice("No markdown file active");return}try{let i=this.noteRepository.generateNoteId(e.path);(await this.embeddingService.embedNote(i)).wasUpdated?new l.Notice(`Embedded: ${e.basename}`):new l.Notice(`Already up to date: ${e.basename}`)}catch(i){new l.Notice("Embedding failed: "+(i instanceof Error?i.message:"Unknown error"))}}async embedAllNotesCommand(){if(!this.isConfigured()){new l.Notice("Please configure API key first");return}new l.Notice("Starting embedding...");try{let e=await this.embedAllNotes(i=>{console.log(`Progress: ${i.completed}/${i.total}`)});new l.Notice(`Complete! ${e.success} embedded, ${e.skipped} skipped, ${e.failed} failed`)}catch(e){new l.Notice("Embedding failed: "+(e instanceof Error?e.message:"Unknown error"))}}async updateStaleCommand(){if(!this.isConfigured()){new l.Notice("Please configure API key first");return}new l.Notice("Updating stale embeddings...");try{let e=await this.embedStaleNotes();new l.Notice(`Complete! ${e.updated} updated, ${e.skipped} skipped, ${e.failed} failed`)}catch(e){new l.Notice("Update failed: "+(e instanceof Error?e.message:"Unknown error"))}}async showStatsCommand(){let e=await this.getStats();new l.Notice(`Embeddings: ${e.totalEmbeddings}
Model: ${e.model}
Last updated: ${e.lastUpdated||"Never"}`)}};
